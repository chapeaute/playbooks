Rabbitmq (todo)
==========

Ansible role which manage RabbitMQ.

Requirements
------------

* None


Role Variables
--------------

| Variable | Default value | Description |
| -------- | ------------- | ----------- |
| `manage_firewalld` | true | Manage firewalld rules |
| `use_satellite_repo` | false | Use official internet repository to install package of this role. In case host have no internet access and package must be install from a local satellite, set this option to `true`. Repository must be previously declare in satellite and VM must be register to it before deploy this role. |
| `rabbitmq_port` | `5672`  | RabbitMQ listen port |
| `rabbitmq_version` | `3.8.2`  | RabbitMQ version to install port |
| `rabbitmq_log_level` | `info`  | RabbitMQ log level |
| `rabbitmq_data_dir` | /var/lib/rabbitmq  | RabbitMQ data directory |
| `rabbitmq_plugins` | ['rabbitmq_management`]  | List of plugins to install |
| `rabbitmq_admin_pass` | **Generated** | Admin password |
| `rabbitmq_users` | [ ] | List of rabbitmq users to create |
| `rabbitmq_users_remove` | [ ] | List of RabbitMQ users to remove |

# Tuning parameters
| Variable | Default value | Description |
| -------- | ------------- | ----------- |
| `rabbitmq_limit_nofiles` | `64000` | File limit allow to open for `rabbitmq` user |
| `rabbitmq_vm_memory_high_watermark_prct` | `0.66` | Pourcentage of memory allocated to rabbitmq. Don't used more than 70% of RAM (https://www.rabbitmq.com/production-checklist.html#resource-limits-ram) |
| `rabbitmq_vm_memory_high_watermark` | 66% of RAM | Memory allocated to rabbitmq in MB |
| `rabbitmq_disk_free_limit_absolute_prct` | `0.1` | Minimum available pourcent disk space. On a RabbitMQ node if available disk space drops below `rabbitmq_disk_free_limit_absolute``all new messages will be blocked until the disk alarm clears |

Sample variables

```yaml

 # Ensure the plugins is installed
rabbitmq_plugins:
  - rabbitmq_management

rabbitmq_users:                         # Ensure the users added
  - user: toto
    password: admin
    vhost: /
    configure_priv: .*
    read_priv: .*
    write_priv: .*
    tags: administrator
```

Dependencies
------------

* None


Example Playbook
----------------

```yaml

- hosts: all
  roles:
    - rabbitmq
```

You can now access the management web interface via:  **http://IP_ADDRESS:15672** with user `admin` and autogenerated password in credential directory.

Testing
--------

Install molecule and docker

```bash
sudo pip2 install molecule docker
For docker just follow the official doc
https://docs.docker.com/engine/installation/#supported-platforms
```

Launch the test with this command.

```
molecule verify # lint role
molecule check # dry run
molecule test # launch test from scracth
# You can relaunch test after with existing instances
ansible-playbook playbook
```

Docs on testing:
https://molecule.readthedocs.io

License
-------

BSD

Author Information
------------------

* Jean-Vincent KASSI <jekas@smile.ci>
* Sebastien GIRAUD <sebastien.giraud@smile.ci>

